<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - MutluSepet</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/MutluSepet.styles.css" asp-append-version="true" />

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>
    <!-- En üst bar -->
    <div style="background: linear-gradient(90deg, #ff7e5f, #feb47b); color: white; text-align:center; padding:5px 0;">
        Mutlu Seçimler Mutlu Sepetler!
    </div>

    <!-- Navbar -->
    <!-- Navbar -->
  <header>
    <nav class="navbar navbar-expand-sm navbar-light bg-light border-bottom box-shadow mb-0">
      <div class="container-fluid">
        <div class="d-flex align-items-center w-100">
          <!-- Sol: Logo -->
          <a class="navbar-brand fw-bold me-3" asp-area="" asp-controller="Product" asp-action="Index">
            <span style="color:orange;">Mutlu</span><span style="color:pink;">Sepet</span>
            <i class="bi bi-cart-fill"></i>
          </a>

          <!-- Ortada: Arama -->
<form class="d-flex flex-grow-1 me-3" asp-controller="Product" asp-action="Index" method="get">
    <div style="position: relative; width: 100%;">
        <input id="searchBox" 
               class="form-control me-2" 
               style="width:100%;" 
               type="search" 
               name="search" 
               placeholder="Ürün Ara..." 
               autocomplete="off"
               aria-label="Search">
        <input type="hidden" name="search" id="searchHidden" /> <!---->
        <!-- Önerilerin çıkacağı kutu -->
        <div id="suggestions" 
             class="list-group" 
             style="position: absolute; top:100%; left:0; right:0; z-index: 1000; display:none;">
        </div>
    </div>
    <button class="btn btn-outline-success" type="submit">Ara</button>
</form>

          <!-- Sağ: Hesabım (dropdown) / Favoriler / Sepet  -->
         <!-- Sağ: Hesabım (dropdown) / Favoriler / Sepet  -->
<ul class="navbar-nav mb-2 mb-lg-0 d-flex flex-row align-items-center">
    <!-- Hesabım dropdown -->
    <li class="nav-item dropdown me-2">
        <a class="nav-link dropdown-toggle" href="#" id="hesabimDropdown" role="button"
           data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle"></i> Hesabım
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="hesabimDropdown">
            @using Microsoft.AspNetCore.Identity
            @inject MutluSepet.Data.ApplicationDbContext _context

            @inject SignInManager<MutluSepet.Models.ApplicationUser> SignInManager
            @inject UserManager<MutluSepet.Models.ApplicationUser> UserManager

            @if (SignInManager.IsSignedIn(User)) 
            {
                <!-- Kullanıcı giriş yaptıysa Çıkış butonu -->
                <li>
                    <form asp-area="Identity" asp-page="/Account/Logout" method="post" class="d-inline">
                        <button type="submit" class="dropdown-item">Çıkış Yap</button>
                    </form>
                </li>
            }
            else
            {
                <!-- Kullanıcı giriş yapmadıysa Giriş / Kayıt linkleri -->
                <li>
                    <a class="dropdown-item" asp-area="Identity" asp-page="/Account/Login">Giriş Yap</a>
                </li>
                <li>
                    <a class="dropdown-item" asp-area="Identity" asp-page="/Account/Register">Kayıt Ol</a>
                </li>
            }
        </ul>
    </li>

    <!-- Favoriler -->
    <li class="nav-item me-2">
        @if (SignInManager.IsSignedIn(User)) 
        {
            <!-- Giriş yaptıysa Favorilerim sayfası -->
            <a class="nav-link" asp-area="" asp-controller="Favorite" asp-action="Index">
                <i class="bi bi-heart-fill"></i> Favorilerim
            </a>
        }
        else
        {
            <!-- Giriş yapmadıysa Login sayfasına yönlendir -->
            <a class="nav-link" asp-area="Identity" asp-page="/Account/Login">
                <i class="bi bi-heart-fill"></i> Favorilerim
            </a>
        }
    </li>

    <!-- Sepet -->
    <li class="nav-item">
        @if (SignInManager.IsSignedIn(User)) 
        {
            <!-- Giriş yaptıysa Sepetim sayfası -->
            <a class="nav-link" asp-area="" asp-controller="Cart" asp-action="Index">
                <i class="bi bi-cart-fill"></i> Sepetim
            </a>
        }
        else
        {
            <!-- Giriş yapmadıysa Login sayfasına yönlendir -->
            <a class="nav-link" asp-area="Identity" asp-page="/Account/Login">
                <i class="bi bi-cart-fill"></i> Sepetim
            </a>
        }
    </li>
</ul>

        </div>
      </div>
    </nav>
        <!-- Kategoriler menüsü -->
        <!-- Kategoriler menüsü -->
<div class="bg-white border-top" style="border-top: 2px solid pink;">
    <div class="container py-2">
<!------------------------------------------------------------------------------->
@{
    var categories = _context.Categories.ToList();
}
<ul class="nav flex-wrap">
@foreach(var cat in categories)
{
    <li class="nav-item me-2 mb-2">
        <a class="category-btn" asp-controller="Product" asp-action="Category" asp-route-id="@cat.Id">@cat.Name</a>
    </li>
}
</ul>

        @* <ul class="nav flex-wrap">
            ...
        </ul> *@
    </div>
</div>

    </header>

    <div class="container mt-3">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2025 - MutluSepet
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <!-- 🔍 Arama önerileri script -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function () {
        var $searchBox = $("#searchBox");
        var $suggestions = $("#suggestions");

        $searchBox.on("input", function () {
            var query = $(this).val();
            if (query.length < 2) {
                $suggestions.hide();
                return;
            }

            $.getJSON('/Product/SearchSuggestions', { term: query }, function (data) {
                $suggestions.empty();
                if (data.length > 0) {
                    data.forEach(function (item) {
                        $suggestions.append(
                            `<a href="/Product/Index?search=${encodeURIComponent(item)}" 
                               class="list-group-item list-group-item-action">${item}</a>`
                        );
                    });
                    $suggestions.show();
                } else {
                    $suggestions.hide();
                }
            });
        });

        // Boş alana tıklayınca önerileri kapat
        $(document).click(function (e) {
            if (!$(e.target).closest('#searchBox, #suggestions').length) {
                $suggestions.hide();
            }
        });
    });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
